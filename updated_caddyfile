{
    # Global settings
    email admin@a2-agent.k42.ventures
}

# Main domain serves frontend with API proxying for specific paths
a2-agent.k42.ventures, a2.k42.ventures, agent.k42.ventures {
    encode gzip

    # Serve static files for frontend (except API routes)
    @not_api not path /health* /health/* /v1/* /openrouter/* /docs /api/*
    handle @not_api {
        reverse_proxy http://frontend:80
    }

    # Proxy API requests to the backend
    handle /health* {
        reverse_proxy http://backend:8001
    }

    handle /health/* {
        reverse_proxy http://backend:8001
    }

    handle /v1/* {
        reverse_proxy http://backend:8001
    }

    handle /openrouter/* {
        reverse_proxy http://backend:8001
    }

    handle /docs {
        reverse_proxy http://backend:8001
    }

    handle /api/* {
        reverse_proxy http://backend:8001
    }
}

# API-only domain - commented out until needed/verified
# a2-agent-api.k42.ventures {
#     encode gzip
#
#     # Direct proxy to Ollama chat completions endpoint
#     handle /ollama/chat/completions {
#         rewrite * /api/chat
#         reverse_proxy http://161.97.152.192:11434
#     }
#
#     # Fallback: proxy all other requests to the backend API
#     handle {
#         reverse_proxy http://backend:8001
#     }
# }

# Research domain - Landing page with tools and A2 Agent
research.k42.ventures {
    root * /usr/share/caddy
    file_server
}

# AgenticSeek application
agenticseek.k42.ventures {
    reverse_proxy http://host.docker.internal:7777
}

# Wildcard routing for anything.k42.ventures as a catch-all for research tools
anything.k42.ventures {
    reverse_proxy http://host.docker.internal:7777
}

# General wildcard routing for other research subdomains (optional, can be commented out if not needed)
# *.k42.ventures {
#     reverse_proxy http://host.docker.internal:7777
# }